본 글은 켄트 백의 <테스트 주도 개발>을 읽고 개인적으로 정리한 내용입니다. 내용에 오류가 있을 시 지적해주시면 감사하겠습니다.

# 저자의 글



### 테스트 주도 개발의 2원칙

* 오직 자동화된 테스트가 실패할 경우에만 새로운 코드를 작성한다.

* 중복을 제거한다.



이 규칙에 의거하여 행동 패턴이 만들어지고, 다음과 같은 프로그래밍 순서가 만들어진다.

* `빨강`  - 실패하는 작은 테스트를 작성한다. 컴파일이 되지 않아도 좋다.
* `초록` - 빨리 테스트가 통과하게끔 만든다. 이 과정에서 코드 복붙, 테스트 통과를 위해 함수가 무조건 상수를 반환하기 등의 꼼수를 써도 상관없다.
* `리팩토링` - 일단 테스트를 통과하게만 하는 와중에 생겨난 모든 중복을 제거한다.



----



# 1장 - 다중 통화를 지원하는 Money 객체



* 다중통화를 지원하는 보고서를 생성하려면, 기존의 금액체계에 통화 단위를 추가하고, 환율을 명시해야 한다.

  > 예를들어, $5 + 10CHF = $10(환율이 2:1일 경우)
  >
  > 따라서 $5 * 2 =$10

* 이 과정에서 해야할 일은 두 가지가 나온다.

  * 통화가 다른 두 금액을 더해 주어진 환율에 맞게 변한 금액을 결과로 얻을 수 있어야 함
  * 주가 * 주식 수의 금액을 결과로 얻을 수 있어야 함



보아하니 첫번째 테스트는 좀 복잡해보인다. 가벼운 일부터 먼저 처리하자. 두번째 테스트부터 작성한다.



```java
public void testMultiplication() {
  Dollar five = new Dollar(5);
  five.times(2);
  assertEquals(10, five.amount);
}
```

이 코드는 지금 '빨강' 상태이다. public 필드이기도 하고, 금액 계산에 정수형을 사용하고 있다. 일단 '초록'을 보기 위해 문제사항들을 다 적어놓고 진행한다.

* $5 + 10CHF = $10(환율이 2:1일 경우)
* $5 * 2 = $10
* amount를 private으로 만들기
* Dollar 부작용?
* Money 반올림?



컴파일이 되게 만드려면 다음과 같은 컴파일에러를 해결해야한다.

> 1. Dollar 클래스가 없음
>
> 2. 생성자가 없음
>
> 3. times(int) 메서드가 없음
>
> 4. amount 필드가 없음



일단 컴파일이 되게 하기 위해서, 위의 구현들을 정말 '최소한'으로 한다.(정말 아무 로직도 안짜도 된다)



```java
class Dollar // #1
```

```java
Dollar(int amount) // #2
```

```java
void times(int multiplier) // #3
```

```java
int amount; // #4
```



컴파일은 되었지만, amount의 예상액이 10이 나와야 assertEquals를 통과하는데, amount값이 0이라 통과하지 못한다. 따라서



```java
int amount=10;
```



amount를 그냥 10으로 바꿔준다.(...??)

어찌됐든 결과가 앞으로 이렇게 나와야 하니, __껍데기만 작성__해두자. 그럼 테스트를 통과했다!



그렇다면 이제 중복을 제거한다. 위의 예제에서는 중복이 잘 보이지 않는것 같지만, 사실은 다음과 같은 중복이 있음을 알 수 있다.

```java
int amount = 5 * 2; // new Dollar(5)와 five.times(2)에서 나왔던 5와 2가 중복하여 등장하고 있다.
```

따라서 다음과 같이 리팩토링하여 중복을 제거한다.

```java
int amount;

Dollar(int amount){
  this.amount = amount;
}

void times(int multiplier){
  // amount = 5 * 2;
  // amount = amount * 2;
  // amount = amount * multiplier;
  // amount *= multiplier;
}
```



그럼 우리는 적어도 다섯가지 문제사항 중 두번째는 해결한 것이다.

* $5 + 10CHF = $10(환율이 2:1일 경우)
* ~~$5 * 2 = $10~~
* amount를 private으로 만들기
* Dollar 부작용?
* Money 반올림?